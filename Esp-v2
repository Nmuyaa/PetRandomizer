-- SERVICES
local players = game:GetService("Players")
local localPlayer = players.LocalPlayer or players:GetPlayers()[1]
local collectionService = game:GetService("CollectionService")
local runService = game:GetService("RunService")

-- DATA
local eggChances = {
    ["Common Egg"] = {["Dog"] = 33, ["Bunny"] = 33, ["Golden Lab"] = 33},
    ["Uncommon Egg"] = {["Black Bunny"] = 25, ["Chicken"] = 25, ["Shiba Inu"] = 25, ["Grey Bunny"] = 25},
    ["Rare Egg"] = {["Cow"] = 25, ["Goat"] = 25, ["Duck"] = 25, ["Pug"] = 25},
    ["Epic Egg"] = {["Horse"] = 30, ["Bee"] = 30, ["Unicorn"] = 30, ["Firefly"] = 10},
    ["Legendary Egg"] = {["Dragon"] = 15, ["Phoenix"] = 15, ["Griffin"] = 15, ["Panda"] = 15, ["Penguin"] = 15, ["Tiger"] = 25},
}

-- SETTINGS
local cooldown = 5
local canClick = true
local autoReroll = false
local displayedEggs = {}

-- FUNCTION: Get pet from egg
local function getPetForEgg(eggName)
    local pets = eggChances[eggName]
    if not pets then return "Unknown" end

    local totalWeight = 0
    for _, weight in pairs(pets) do
        totalWeight += weight
    end

    local rand = math.random() * totalWeight
    local cumulative = 0
    for petName, weight in pairs(pets) do
        cumulative += weight
        if rand <= cumulative then
            return petName
        end
    end

    return "Unknown"
end

-- GUI SETUP
local gui = Instance.new("ScreenGui", localPlayer:WaitForChild("PlayerGui"))
gui.Name = "PetPredictorUI"
gui.ResetOnSpawn = false

-- MAIN FRAME
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 260, 0, 200)
frame.Position = UDim2.new(0, 10, 0.5, -100)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0

-- UI CORNER
local uiCorner = Instance.new("UICorner", frame)
uiCorner.CornerRadius = UDim.new(0, 10)

-- BUTTON
local predict = Instance.new("TextButton", frame)
predict.Size = UDim2.new(1, -20, 0, 40)
predict.Position = UDim2.new(0, 10, 0, 10)
predict.Text = "âœ¨ Reroll Egg"
predict.Font = Enum.Font.GothamBold
predict.TextSize = 18
predict.TextColor3 = Color3.fromRGB(255, 255, 255)
predict.BackgroundColor3 = Color3.fromRGB(60, 130, 200)

-- AUTO REROLL TOGGLE
local toggle = Instance.new("TextButton", frame)
toggle.Size = UDim2.new(1, -20, 0, 40)
toggle.Position = UDim2.new(0, 10, 0, 60)
toggle.Text = "ðŸ” Auto Reroll: OFF"
toggle.Font = Enum.Font.Gotham
toggle.TextSize = 16
toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
toggle.BackgroundColor3 = Color3.fromRGB(100, 100, 100)

toggle.MouseButton1Click:Connect(function()
    autoReroll = not autoReroll
    toggle.Text = autoReroll and "ðŸ” Auto Reroll: ON" or "ðŸ” Auto Reroll: OFF"
end)

-- FIND AND TAG EGG MODELS
for _, egg in ipairs(workspace:GetDescendants()) do
    if egg:IsA("Model") and egg:FindFirstChild("EggName") then
        local eggName = egg.EggName.Value
        if eggChances[eggName] then
            local billboard = Instance.new("BillboardGui")
            billboard.Size = UDim2.new(0, 200, 0, 30)
            billboard.StudsOffset = Vector3.new(0, 2, 0)
            billboard.AlwaysOnTop = true
            billboard.Parent = localPlayer:WaitForChild("PlayerGui")

            local label = Instance.new("TextLabel", billboard)
            label.Size = UDim2.new(1, 0, 1, 0)
            label.BackgroundTransparency = 1
            label.TextColor3 = Color3.fromRGB(255, 255, 0)
            label.TextStrokeTransparency = 0
            label.Font = Enum.Font.GothamBold
            label.TextSize = 16
            label.Text = eggName
            billboard.Adornee = egg

            table.insert(displayedEggs, {
                egg = egg,
                eggName = eggName,
                label = label,
                currentPet = ""
            })
        end
    end
end

-- COOLDOWN + REROLL FUNCTION
predict.MouseButton1Click:Connect(function()
    if not canClick then return end
    canClick = false

    for _, data in pairs(displayedEggs) do
        local newPet = getPetForEgg(data.eggName)
        data.currentPet = newPet
        if data.label then
            data.label.Text = string.format("%s | %s", data.eggName, newPet)
        end
    end

    -- Countdown w/ decimal
    task.spawn(function()
        local remaining = cooldown
        while remaining > 0 do
            predict.Text = string.format("Cooldown (%.2fs)", remaining)
            for _, data in pairs(displayedEggs) do
                if data.label then
                    data.label.Text = string.format("%s | %s (%.2fs)", data.eggName, data.currentPet, remaining)
                end
            end
            task.wait(0.1)
            remaining -= 0.1
        end

        predict.Text = "âœ¨ Reroll Egg"
        for _, data in pairs(displayedEggs) do
            if data.label then
                data.label.Text = string.format("%s | %s", data.eggName, data.currentPet)
            end
        end

        canClick = true
    end)
end)

-- AUTO REROLL LOOP
task.spawn(function()
    while true do
        task.wait(0.1)
        if autoReroll and canClick then
            predict:MouseButton1Click:Fire()
        end
    end
end)
